import pandas as pd
import random
import string

def mask_numeric_value(val):
    if pd.isnull(val):
        return val

    val_str = str(val).strip()

    # Check if it's numeric (pure digits or float)
    try:
        float(val_str)
        is_numeric = True
    except:
        is_numeric = False

    if is_numeric:
        # Replace digits with random digits, keep non-digit chars (like . or -)
        return ''.join(
            random.choice(string.digits) if ch.isdigit() else ch
            for ch in val_str
        )
    else:
        return val  # Leave alphanumerics unchanged

def mask_numeric_columns_in_all_sheets(file_path, columns_to_mask, output_file):
    all_sheets = pd.read_excel(file_path, sheet_name=None)

    updated_sheets = {}

    for sheet_name, df in all_sheets.items():
        print(f"\nüìÑ Processing sheet: {sheet_name}")
        df.columns = df.columns.str.strip()

        for col in columns_to_mask:
            if col in df.columns:
                print(f"üî¢ Masking numeric values in column: {col}")
                df[col] = df[col].apply(mask_numeric_value)
            else:
                print(f"‚ö†Ô∏è Column '{col}' not found in sheet '{sheet_name}'")

        updated_sheets[sheet_name] = df

    with pd.ExcelWriter(output_file, engine='openpyxl') as writer:
        for sheet_name, df in updated_sheets.items():
            df.to_excel(writer, sheet_name=sheet_name, index=False)

    print(f"\n‚úÖ Numeric masking complete. Output saved to: {output_file}")